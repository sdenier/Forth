From f36b56c8fe61c1d6000427c1ed099bd3a35f2e79 Mon Sep 17 00:00:00 2001
From: Simon Denier <simon@sogilis.com>
Date: Thu, 19 Jul 2012 11:40:41 +0200
Subject: [PATCH 2/3] Define Forth conditions

---
 features/conditions.feature | 13 +++++++++++++
 forth                       | 12 ++++++++++++
 2 files changed, 25 insertions(+)
 create mode 100644 features/conditions.feature

diff --git a/features/conditions.feature b/features/conditions.feature
new file mode 100644
index 0000000..ef3f504
--- /dev/null
+++ b/features/conditions.feature
@@ -0,0 +1,13 @@
+Feature: The Forth interpreter shall understand IF constructions
+
+  Background:
+    Given a forth interpreter
+
+  Scenario: If True
+     When I execute "3 5 < IF 1 . ELSE 2 . THEN 3 ."
+     Then I should get "1 3 ok"
+
+  Scenario: If False
+     When I execute "6 5 < IF 1 . ELSE 2 . THEN 3 ."
+     Then I should get "2 3 ok"
+
diff --git a/forth b/forth
index 9576cbe..28af5ce 100755
--- a/forth
+++ b/forth
@@ -49,6 +49,18 @@ symbol_table['.'] = function(...)
   io.write(tostring(pop()), " ")
 end -- '.'
 
+symbol_table.IF = function(original_dispatcher)
+  if pop() then
+    return make_dispatch_execute_until(original_dispatcher, "ELSE",
+      make_dispatch_skip_until("THEN",
+        original_dispatcher))
+  else
+    return make_dispatch_skip_until("ELSE",
+      make_dispatch_execute_until(original_dispatcher, "THEN",
+        original_dispatcher))
+  end
+end -- IF/ELSE
+
 --
 --  Dispatch
 ----------------
-- 
1.8.1.3

